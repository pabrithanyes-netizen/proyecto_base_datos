AUDITOR√çA DE FACTURAS (INCONSISTENCIAS)
========================================================= */
select f.id_factura,
       f.subtotal,
       f.impuesto,
       f.total,
       (f.subtotal + f.impuesto) as subtotal_mas_impuesto,
       (f.subtotal + f.impuesto) - f.total as diferencia_total,
       (select sum(df.subtotal_linea)
        from bpanchana.detalle_factura df
        where df.id_factura = f.id_factura) as suma_detalle,
       f.subtotal -
       (select sum(df.subtotal_linea)
        from bpanchana.detalle_factura df
        where df.id_factura = f.id_factura) as diferencia_detalle
from bpanchana.factura f
where (f.subtotal + f.impuesto) <> f.total
   or f.subtotal <>
      (select sum(df.subtotal_linea)
       from bpanchana.detalle_factura df
       where df.id_factura = f.id_factura);
