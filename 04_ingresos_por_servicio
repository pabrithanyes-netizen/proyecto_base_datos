INGRESOS POR TIPO DE SERVICIO Y PARTICIPACIÃ“N (%)
========================================================= */
with ingresos_servicio as (
    select df.descripcion,
           sum(df.subtotal_linea) as total_ingresos
    from bpanchana.detalle_factura df
         inner join bpanchana.factura f
         on df.id_factura = f.id_factura
    where f.estado = 'PAGADA'
      and f.activo = true
      and df.activo = true
    group by df.descripcion
)
select isv.descripcion,
       isv.total_ingresos,
       (isv.total_ingresos * 100.0 /
        (select sum(total_ingresos) from ingresos_servicio)
       ) as participacion_porcentaje
from ingresos_servicio isv
order by isv.total_ingresos desc;
